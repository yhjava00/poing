<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="main">
	
	<select id="test" resultType="memberVO">
		select * from member where id=#{admin}
	</select>
	
	<select id="category" resultType="categoryVO">
		select * from category
	</select>
	
	<select id="selectRecommendList" resultType="storeVO">
		<![CDATA[select * from store where rownum < 10]]>
	</select>
	
	<select id="selectMember" parameterType="String" resultType="memberVO">
		select * from member where id=#{id} 
	</select>
	
	<insert id="insertMember" parameterType="memberVO">
		insert into member (id, pw, nickname) values(#{id}, #{pw}, #{nickname})
	</insert>
	
	<select id="totSearchNO" parameterType="String" resultType="int">
		select count(idx) from store where store_name like '%' || #{search} || '%' or category like '%' || #{search} || '%'
	</select>
	
	<select id="selectSearchList" parameterType="map" resultType="storeVO">
		select * 
		from (select rownum rn, A.* 
				from (select s.* 
						from store s 
						where s.store_name like '%' || #{search} || '%' or s.category like '%' || #{search} || '%' 
						order by s.idx desc) A)
		where rn between (#{page}-1) * 12 + 1 and #{page} * 12 
	</select>
	
	<select id="selectStoreAllList" parameterType="int" resultType="storeAllVO">
		select * from store s inner join store_info i on s.idx = i.store_idx where s.idx = #{idx} 
	</select>
	
	<select id="selectstoreImgList" parameterType="int" resultType="String">
		select img_name from store_img where store_idx = #{idx}
	</select>
	
	<select id="unreservedTimeList" parameterType="map" resultType="String">
		<![CDATA[
		select DISTINCT(time)
		from reservation r inner join store_info i 
		on r.store_idx = i.store_idx 
		where resdate = #{date} 
		and  i.max_num_people < (select sum(people_num)
								 from reservation 
								 where store_idx = #{idx} 
								 and time = r.time) + #{peopleNum}
		]]>
	</select>
	
</mapper>